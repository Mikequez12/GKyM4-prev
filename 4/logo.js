worlds = {
    online:[
        [
            ["air","air","air","air","air","grass","grass","grass","grass","grass"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","leaves","leaves","leaves","air"],
            ["air","air","air","air","air","air","leaves","leaves","leaves","air"],
            ["air","air","air","air","air","air","leaves","leaves","leaves","air"]
        ],[
            ["air","air","air","air","air","grass","grass","grass","grass","grass"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","leaves","leaves","leaves","leaves","leaves"],
            ["air","air","air","air","air","leaves","leaves","leaves","leaves","leaves"],
            ["air","air","air","air","air","leaves","leaves","leaves","leaves","leaves"],
            ["air","air","air","air","air","air","leaves","leaves","leaves","air"]
        ],[
            ["air","air","air","air","air","grass","grass","grass","grass","grass"],
            ["air","air","air","air","air","air","air","log","air","air"],
            ["air","air","air","air","air","air","air","log","air","air"],
            ["air","air","air","air","air","air","air","log","air","air"],
            ["air","air","air","air","air","leaves","leaves","log","leaves","leaves"],
            ["air","air","air","air","air","leaves","leaves","leaves","leaves","leaves"],
            ["air","air","air","air","air","leaves","leaves","leaves","leaves","leaves"],
            ["air","air","air","air","air","air","leaves","leaves","leaves","air"]
        ],[
            ["air","air","air","air","air","grass","grass","grass","grass","grass"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","leaves","leaves","leaves","leaves","leaves"],
            ["air","air","air","air","air","leaves","leaves","leaves","leaves","leaves"],
            ["air","air","air","air","air","leaves","leaves","leaves","leaves","leaves"],
            ["air","air","air","air","air","air","leaves","leaves","leaves","air"]
        ],[
            ["air","air","air","air","air","grass","grass","grass","grass","grass"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","leaves","leaves","leaves","air"],
            ["air","air","air","air","air","air","leaves","leaves","leaves","air"],
            ["air","air","air","air","air","air","leaves","leaves","leaves","air"]
        ],[
            ["grass","grass","grass","grass","grass","grass","grass","grass","grass","grass"],
        ],[
            ["grass","grass","grass","grass","grass","grass","grass","grass","grass","grass"],
        ],[
            ["grass","grass","grass","grass","grass","grass","grass","grass","grass","grass"],
            ["air","air","crafting table"]
        ],[
            ["grass","grass","grass","grass","grass","grass","grass","grass","grass","grass"],
        ],[
            ["grass","grass","grass","grass","grass","grass","grass","grass","grass","grass"],
        ]
    ],
    starting:[
        [
            ["air","air","air","air","air","error","error","error","error","error"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","error","error","error","air"],
            ["air","air","air","air","air","air","error","error","error","air"],
            ["air","air","air","air","air","air","error","error","error","air"]
        ],[
            ["air","air","air","air","air","error","error","error","error","error"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","error","error","error","error","error"],
            ["air","air","air","air","air","error","error","error","error","error"],
            ["air","air","air","air","air","error","error","error","error","error"],
            ["air","air","air","air","air","air","error","error","error","air"]
        ],[
            ["air","air","air","air","air","error","error","error","error","error"],
            ["air","air","air","air","air","air","air","error","air","air"],
            ["air","air","air","air","air","air","air","error","air","air"],
            ["air","air","air","air","air","air","air","error","air","air"],
            ["air","air","air","air","air","error","error","error","error","error"],
            ["air","air","air","air","air","error","error","error","error","error"],
            ["air","air","air","air","air","error","error","error","error","error"],
            ["air","air","air","air","air","air","error","error","error","air"]
        ],[
            ["air","air","air","air","air","error","error","error","error","error"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","error","error","error","error","error"],
            ["air","air","air","air","air","error","error","error","error","error"],
            ["air","air","air","air","air","error","error","error","error","error"],
            ["air","air","air","air","air","air","error","error","error","air"]
        ],[
            ["air","air","air","air","air","error","error","error","error","error"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","air","air","air","air"],
            ["air","air","air","air","air","air","error","error","error","air"],
            ["air","air","air","air","air","air","error","error","error","air"],
            ["air","air","air","air","air","air","error","error","error","air"]
        ],[
            ["error","error","error","error","error","error","error","error","error","error"],
        ],[
            ["error","error","error","error","error","error","error","error","error","error"],
        ],[
            ["error","error","error","error","error","error","error","error","error","error"],
            ["air","air","error"]
        ],[
            ["error","error","error","error","error","error","error","error","error","error"],
        ],[
            ["error","error","error","error","error","error","error","error","error","error"],
        ]
    ],
    offline:[
        [
            ['sand','sand','sand','sand','sand']
        ],[
            ['sand','sand','sand','sand','sand']
        ],[
            ['sand','sand','sand','sand','sand'],
            ['air','air','dead plant','air','air']
        ],[
            ['sand','sand','sand','sand','sand']
        ],[
            ['sand','sand','sand','sand','sand']
        ],
    ],
    error:[
        [
            ['error'],
            ['air'],
            ['error'],
            ['error'],
            ['error']
        ]
    ]
}

Array.prototype.get = function(index, defaultValue = undefined) {
    return index >= 0 && index < this.length ? this[index] : defaultValue;
}

function drawWorld(textures,zoom=50) {
    var xW = Math.max(...textures.map((line) => Math.max(...line.map((line2) => line2.length))));
    var yW = Math.max(...textures.map((line) => line.length));
    var zW = textures.length;

    for (let x = 0; x < xW; x++) {
        for (let y = 0; y < yW; y++) {
            for (let z = 0; z < zW; z++) {
                let block = document.querySelector('div#blockcanvas').appendChild(document.createElement('img'));
                block.src = `blocks/${textures.get(z,[]).get((yW-1) - y,[]).get(x,"air")}.png`;

                block.style.imageRendering = 'pixelated';

                block.classList.add('block');

                block.style.position = 'absolute';

                block.style.setProperty('--size',`${zoom}px`);

                block.style.left = `calc(50% + ${(z - x - 1) * zoom}px)`;
                block.style.top = `calc(10px + ${(z/2 + x/2 + y) * zoom}px)`;

                block.style.zIndex = yW-y;

                setTimeout(function() {
                    block.classList.add('show');
                },(x+(yW-y)+z)*100);
            }
        }
    }
}

async function main() {
    console.log('loading');
    let response = await fetch('https://api.mcstatus.io/v2/status/java/gatokawaiiymagico4.aternos.me')
        .then((response) => {if (response.ok) { return response.json() } else { throw new Error("Can't fetch") }})
        .then((data) => data.motd.raw);

    console.log('done',response);
    title = document.querySelector('h1#status');
    let world;
    if (response == '§7This server is currently preparing.\n§8Please try again in a few seconds.') { // PREPARANDO //
        world = worlds.starting;
        title.textContent = 'Preparando'
    } else if (response == 'done §7This server is currently stopping.\nGet this server §amore RAM§7 for §7§lfree!§8 > §a§ncraft.link/ram') {
    } else if (response == '§7This server is currently stopping.\nGet this server §amore RAM§7 for §7§lfree!§8 > §a§ncraft.link/ram') {
        world = worlds.starting;
        title.textContent = 'Deteniendo'
    } else if (response == "§c ⭐ ★§c§l Gatokawaiiymágico 4 §c★ ⭐\n§4             ◆  1.21.1  ◆") { // ONLINE //
        world = worlds.online;
        title.textContent = 'Online'
    } else if (response == "§cThis server is offline.\n§7Get this server §amore RAM§7 for §7§lfree!§8 \u003e §a§ncraft.link/ram") { // OFFLINE //
        world = worlds.offline;
        title.textContent = 'Offline'
    } else { // UNKNOWN //
        world = worlds.error;
        title.textContent = 'ERROR DESCONOCIDO'
    }
    
    console.log(world);
    await drawWorld(world);
}

document.addEventListener('DOMContentLoaded',(DOMEvent) => {main()});